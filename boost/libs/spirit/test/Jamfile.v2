#==============================================================================
#   Copyright (c) 2002 Joel de Guzman
#   Copyright (c) 2003-2004 Martin Wille
#   http://spirit.sourceforge.net/
#
#   Use, modification and distribution is subject to the Boost Software
#   License, Version 1.0. (See accompanying file LICENSE_1_0.txt or copy at
#   http://www.boost.org/LICENSE_1_0.txt)
#==============================================================================
#
#  Spirit regression test boost-jam file
#  Joel de Guzman [Sept 27, 2002]
#



# VP, 2005/04/14: Inside boost, we inherit proper <include>
# from Jamroot.
# Not sure about standalone Spirit.
# SPIRIT_HEADER_INCLUDE ?= ../../.. ;
# spirit-header-include = <include>$(SPIRIT_HEADER_INCLUDE) ;

rule spirit-run ( sources + : args * : input-files * : requirements * : name ? : default-build * )
{
    name ?= $(sources[1]:D=:S=) ;
    return  
       [ run $(sources) : $(args) : $(input-files) : $(requirements) : $(name)
        : $(default-build) ]
       [ run $(sources) : $(args) : $(input-files) : $(requirements)
          <define>BOOST_SPIRIT_DEBUG=1 : $(name)_debug
        : $(default-build) ]
        ;
}

############################################################

local opt = <toolset>vc-7.0:<optimization>speed
            <toolset>vc-7.0:<inlining>on
            <toolset>cw:<optimization>speed ;

local opt-metrowerks = <toolset>cw:<optimization>speed ;


# VP, 2005/04/14: MT is not available with Como, but this is
# not handled yet.
local multi-threading = <library>/boost/thread//boost_thread 
                        <threading>multi <define>BOOST_ALL_NO_LIB=1 ;

    test-suite "spirit.core.kernel"
        : [ spirit-run match_tests.cpp ]
          [ spirit-run bug_000002.cpp ]
        ;

    test-suite "spirit.core.scanner"
        : [ spirit-run scanner_tests.cpp ]
        ;

    test-suite "spirit.core.primitive"
        : [ spirit-run primitives_tests.cpp ]
          [ spirit-run numerics_tests.cpp : : : $(opt) ]
        ;

    test-suite "spirit.core.composite"
        : [ spirit-run composite_tests.cpp ]
          [ spirit-run epsilon_tests.cpp ]
          [ compile sf_bug_718903.cpp ]
          [ spirit-run actions_tests.cpp ]
          [ spirit-run operators_tests.cpp ]
          [ spirit-run directives_tests.cpp ]
          [ spirit-run shortest_alternative_tests.cpp ]
        ;

    test-suite "spirit.core.non_terminal"
        : [ spirit-run rule_tests.cpp ]
          [ spirit-run owi_st_tests.cpp ]
          [ spirit-run grammar_tests.cpp : : : $(opt-metrowerks) ]
          [ spirit-run subrule_tests.cpp ]
          [        run owi_mt_tests.cpp : : : $(multi-threading) ]
          [        run grammar_mt_tests.cpp : : : $(multi-threading) ]
        ;

    # traverse_tests defines SPIRIT_DEBUG, don't run the tests twice
    test-suite "spirit.meta"
        : [ spirit-run fundamental_tests.cpp ]
          [ spirit-run parser_traits_tests.cpp ]
          [ spirit-run traverse_tests.cpp ]
          [ spirit-run bug_000005.cpp ]
        ;

    test-suite "spirit.attribute"
        : [ spirit-run closure_tests.cpp : : : $(opt-metrowerks) ]
          [        run bug_000008.cpp : : : $(multi-threading) ]
          [ spirit-run parametric_tests.cpp ]
        ;

    test-suite "spirit.error_handling"
        : [ spirit-run exception_tests.cpp ]
        ;

    test-suite "spirit.tree"
        : [ spirit-run bug_000001.cpp ]
          [ spirit-run ast_calc_tests.cpp ]
        ;

# temporarily removed from the test suite. tree_tests are not finished, yet.
#         [ spirit-run tree_tests.cpp ]

    test-suite "spirit.dynamic"
        : [ compile if_p_as_parser_tests.cpp ]
          [ compile while_p_as_parser_tests.cpp ]
          [ compile for_p_as_parser_tests.cpp ]
          [ spirit-run if_tests.cpp ]
          [ spirit-run for_tests.cpp ]
          [ spirit-run while_tests.cpp ]
        ;

    test-suite "spirit.utility"
        : [ spirit-run chset_tests.cpp ]
          [ spirit-run sf_bug_719322.cpp ]
          [ compile bug_000003.cpp ]
          [ spirit-run bug_000004.cpp ]
          [ spirit-run bug_000006.cpp ]
          [ spirit-run bug_000007.cpp ]
          [ spirit-run confix_tests.cpp ]
          [ spirit-run loops_tests.cpp ]
          [ spirit-run symbols_tests.cpp ]
          [ spirit-run escape_char_parser_tests.cpp : : : $(opt) ]
          [ spirit-run scoped_lock_tests.cpp : : : $(multi-threading) ]
        ;

    test-suite "spirit.iterator"
        : [ spirit-run fixed_size_queue_tests.cpp ]
          [ spirit-run file_iterator_tests.cpp ]
          [ spirit-run multi_pass_tests.cpp : : : $(opt-metrowerks) ]
          [ spirit-run sf_bug_720917.cpp : : : $(opt-metrowerks) ]
          [ spirit-run position_iterator_tests.cpp : : : $(opt-metrowerks) ]
        ;

