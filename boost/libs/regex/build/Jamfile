# copyright John Maddock 2003

subproject libs/regex/build ;

#
# this template defines the options common to
# all regex builds and tests:
#
template regex-options
   : # sources
   : # requirements
     <define>BOOST_REGEX_NO_LIB=1        
     <debug><define>BOOST_REGEX_CONFIG_INFO=1
     <sysinclude>$(BOOST_ROOT)
     # como requires this:
     <como-win32><*><define>BOOST_REGEX_NO_W32=1
   ;

#
# this template defines the options common to
# all regex dll builds and tests:
#
template regex-dll-options
   : <template>regex-options # sources
   : # requirements
     <define>BOOST_REGEX_DYN_LINK=1      
     <runtime-link>dynamic
   ;

SOURCES = c_regex_traits c_regex_traits_common cpp_regex_traits
       cregex fileiter posix_api regex regex_debug
       regex_synch w32_regex_traits wide_posix_api instances winstances ;
       
lib boost_regex : ../src/$(SOURCES).cpp <template>regex-options
    : 
    : 
        debug release
    ;


dll boost_regex : ../src/$(SOURCES).cpp <template>regex-dll-options
    : 
    : 
        debug release
    ;
    
local version-tag = [ MATCH "^([^.]+).([^.]+)" : $(BOOST_VERSION) ] ;
version-tag = $(version-tag:J="_") ;

stage stage/lib : <lib>boost_regex <dll>boost_regex
    :
        <locate>$(BOOST_ROOT)
        common-stage-tag
        <tag><postfix>-$(version-tag)
        <target>stage
        <target>all
    :
        debug release
    ;

install regex lib
    : <dll>boost_regex <lib>boost_regex
    ;
