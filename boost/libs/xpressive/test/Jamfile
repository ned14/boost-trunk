# xpressive library test Jamfile

# Copyright Eric Niebler 2004

# Use, modification, and distribution is subject to the Boost Software
# License, Version 1.0. (See accompanying file LICENSE_1_0.txt or copy at
# http://www.boost.org/LICENSE_1_0.txt)

subproject libs/xpressive/test ;

# bring in rules for testing
import testing ;

# A bug in the Win32 intel compilers causes compilation of one of our
# tests to take forever when debug symbols are enabled. This rule
# turns them off when added to the requirements section
local rule xpressive-requirements ( toolset variant : properties * )
{
    if $(NT) && [ MATCH (.*intel.*) : $(toolset) ]
    {
        properties = [ difference $(properties) : <debug-symbols>on ] <debug-symbols>off ;
    }
    if [ MATCH (.*stlport.*) : $(toolset) ]
    {
        properties = $(properties) <define>_STLP_EXPOSE_GLOBALS_IMPLEMENTATION ;
    }
    return $(properties) ;
}

# Make tests run by default.
DEPENDS all : test ;

{

    template multi-threading : <dll>@boost/libs/thread/build/boost_thread :
        <threading>multi
        <define>BOOST_ALL_NO_LIB=1
    ;

    test-suite "xpressive"
        : [ run regress.cpp <lib>../../filesystem/build/boost_filesystem : : : xpressive-requirements ]
          [ run test1.cpp : : : xpressive-requirements ]
          [ run test2.cpp : : : xpressive-requirements ]
          [ run test3.cpp : : : xpressive-requirements ]
          [ run test4.cpp : : : xpressive-requirements ]
          [ run test5.cpp : : : xpressive-requirements ]
          [ run test6.cpp : : : xpressive-requirements ]
          [ run test7.cpp : : : xpressive-requirements ]
          [ run test8.cpp : : : xpressive-requirements ]
          [ run test9.cpp : : : xpressive-requirements ]
          [ run test10.cpp : : : xpressive-requirements ]
          [ run test1u.cpp : : : xpressive-requirements ]
          [ run test2u.cpp : : : xpressive-requirements ]
          [ run test3u.cpp : : : xpressive-requirements ]
          [ run test4u.cpp : : : xpressive-requirements ]
          [ run test5u.cpp : : : xpressive-requirements ]
          [ run test6u.cpp : : : xpressive-requirements ]
          [ run test7u.cpp : : : xpressive-requirements ]
          [ run test8u.cpp : : : xpressive-requirements ]
          [ run test9u.cpp : : : xpressive-requirements ]
          [ run test10u.cpp : : : xpressive-requirements ]
          [ run misc1.cpp : : : xpressive-requirements ]
          [ run test_cycles.cpp  : : : xpressive-requirements ]
#           [ run test_thread.cpp <template>multi-threading : : : xpressive-requirements ]
          [ run test_non_char.cpp : : : xpressive-requirements ]
          [ run test_static.cpp : : : xpressive-requirements ]
          [ run test_dynamic.cpp : : : xpressive-requirements ]
          [ link multiple_defs1.cpp multiple_defs2.cpp : xpressive-requirements : multiple_defs ]
          [ compile test_basic_regex.cpp ]
          [ compile test_match_results.cpp ]
          [ compile test_regex_algorithms.cpp ]
          [ compile test_regex_compiler.cpp ]
          [ compile test_regex_constants.cpp ]
          [ compile test_regex_error.cpp ]
          [ compile test_regex_iterator.cpp ]
          [ compile test_regex_primitives.cpp ]
          [ compile test_regex_token_iterator.cpp ]
          [ compile test_regex_traits.cpp ]
          [ compile test_sub_match.cpp ]
        ;
}
