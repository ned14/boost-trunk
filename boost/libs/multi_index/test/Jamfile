# Boost.MultiIndex tests Jamfile
#
# Copyright 2003-2005 Joaquín M López Muñoz.
# Distributed under the Boost Software License, Version 1.0.
# (See accompanying file LICENSE_1_0.txt or copy at
# http://www.boost.org/LICENSE_1_0.txt)
#
# See http://www.boost.org/libs/multi_index for library home page.

subproject libs/multi_index/test ;

# bring in rules for testing

import testing ;

local rule special-requirements ( toolset variant : properties * )
{
    # GCC on Tru64 has problems with long debug symbols generated by
    # Boost.MultiIndex, so we turn them off when in that platform

    if $(UNIX) && $(OS) = OSF
    {
        switch $(toolset)
        {
            case gcc* : properties =
                [ replace-properties $(properties) : <debug-symbols>off ] ;
        }
    }
    
    return $(properties) ;
}
    
# local specialization of rule run automatically including special requirements

local rule local-run ( sources + : args * : input-files * : requirements *
    : name ? : default-build * : args2 * )
{
    return [ run $(sources) : $(args) : $(input-files)
        : $(requirements) special-requirements
        : $(name) : $(default-build) : $(args2) ] ;
}

# make tests run by default

DEPENDS all : test ;

# bring in Boost.Serialization rules

import ../../../libs/serialization/build/serialization ;

{
    test-suite "multi_index"
        : [ local-run test_basic.cpp            test_basic_main.cpp            ]
        : [ local-run test_capacity.cpp         test_capacity_main.cpp         ]
        : [ local-run test_comparison.cpp       test_comparison_main.cpp       ]
        : [ local-run test_composite_key.cpp    test_composite_key_main.cpp    ]
        : [ local-run test_conv_iterators.cpp   test_conv_iterators_main.cpp   ]
        : [ local-run test_copy_assignment.cpp  test_copy_assignment_main.cpp  ]
        : [ local-run test_hash_ops.cpp         test_hash_ops_main.cpp         ]
        : [ local-run test_iterators.cpp        test_iterators_main.cpp        ]
        : [ local-run test_key_extractors.cpp   test_key_extractors_main.cpp   ]
        : [ local-run test_list_ops.cpp         test_list_ops_main.cpp         ]
        : [ local-run test_modifiers.cpp        test_modifiers_main.cpp        ]
        : [ local-run test_mpl_ops.cpp          test_mpl_ops_main.cpp          ]
        : [ local-run test_observers.cpp        test_observers_main.cpp        ]
        : [ local-run test_projection.cpp       test_projection_main.cpp       ]
        : [ local-run test_range.cpp            test_range_main.cpp            ]
        : [ local-run test_safe_mode.cpp        test_safe_mode_main.cpp        ]
        : [ local-run test_serialization.cpp    test_serialization_main.cpp
                <lib>../../serialization/build/boost_serialization           
            : # args
            : # input files
            : std::locale-support toolset::require-boost-spirit-support        ]
        : [ local-run test_set_ops.cpp          test_set_ops_main.cpp          ]
        : [ local-run test_special_list_ops.cpp test_special_list_ops_main.cpp ]
        : [ local-run test_special_set_ops.cpp  test_special_set_ops_main.cpp  ]
        : [ local-run test_update.cpp           test_update_main.cpp           ]
        ;
}
